# Yappa Challenge DevOps

## üéØ Implementaci√≥n Completa de Infraestructura Cloud-Native

**Proyecto exitosamente completado** con infraestructura GCP completa, aplicaci√≥n Spring Boot 3.2 y CI/CD dual (Azure DevOps + GitHub Actions).

[![CI/CD Pipeline](https://github.com/dastorga/yappa-challenge/actions/workflows/ci-cd.yml/badge.svg)](https://github.com/dastorga/yappa-challenge/actions/workflows/ci-cd.yml)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.0-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![Java](https://img.shields.io/badge/Java-17-red.svg)](https://openjdk.java.net/projects/jdk/17/)
[![GCP](https://img.shields.io/badge/GCP-Cloud%20Run-4285F4.svg)](https://cloud.google.com/run)

## üìã √çndice

- [üèóÔ∏è Arquitectura](#Ô∏è-arquitectura)
- [üß© Componentes](#-componentes)
- [üì¶ Requisitos Previos](#-requisitos-previos)
- [üöÄ Instalaci√≥n Local](#-instalaci√≥n-local)
- [‚òÅÔ∏è Despliegue en GCP](#Ô∏è-despliegue-en-gcp)
- [üîÑ CI/CD](#-cicd)
- [üìä Monitoreo](#-monitoreo)
- [üìÅ Estructura del Proyecto](#-estructura-del-proyecto)
- [üîß Comandos √ötiles](#-comandos-√∫tiles)

## üèóÔ∏è Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                   INTERNET                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          GOOGLE CLOUD PLATFORM                                 ‚îÇ
‚îÇ                                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   Cloud Run     ‚îÇ    ‚îÇ                 VPC Network                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ    ‚îÇ                                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Spring Boot App ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - Java 17       ‚îÇ    ‚îÇ  ‚îÇ   Cloud SQL     ‚îÇ  ‚îÇ    Firestore        ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - Actuator      ‚îÇ    ‚îÇ  ‚îÇ   PostgreSQL    ‚îÇ  ‚îÇ    NoSQL DB         ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - Micrometer    ‚îÇ    ‚îÇ  ‚îÇ   10.2.0.3      ‚îÇ  ‚îÇ                     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ - Port 8080     ‚îÇ    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ                                                  ‚îÇ   ‚îÇ
‚îÇ           ‚îÇ              ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ           ‚îÇ              ‚îÇ  ‚îÇ  Cloud Storage  ‚îÇ  ‚îÇ  Artifact Registry  ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ           ‚îÇ              ‚îÇ  ‚îÇ  Static Files   ‚îÇ  ‚îÇ  Docker Images      ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  VPC Connector  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§                                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Private Egress ‚îÇ    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ     VPN         ‚îÇ  ‚îÇ    Memorystore      ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ                          ‚îÇ  ‚îÇ  On-premises    ‚îÇ  ‚îÇ     Redis           ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ                          ‚îÇ  ‚îÇ   Connection    ‚îÇ  ‚îÇ                     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ                          ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                              CI/CD PIPELINES                                    ‚îÇ
‚îÇ                                                                                 ‚îÇ
‚îÇ  GitHub Actions:                    Azure DevOps:                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ 1. Maven Build  ‚îÇ                ‚îÇ 1. Maven Build & Test               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ 2. Docker Push  ‚îÇ                ‚îÇ 2. Docker Build & Push              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ 3. Cloud Run    ‚îÇ                ‚îÇ 3. Cloud Run Deploy                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ 4. Terraform    ‚îÇ                ‚îÇ 4. Terraform Plan & Apply           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üß© Componentes

### Aplicaci√≥n Spring Boot 3.2

- **Framework**: Spring Boot 3.2.0 con Java 17
- **Puerto**: 8080 (no 5000 como Flask)
- **Actuator**: Health checks y m√©tricas en `/actuator/*`
- **Micrometer**: M√©tricas para Prometheus en `/actuator/prometheus`
- **Profiles**: `dev`, `prod` con configuraciones espec√≠ficas
- **Container**: Docker multi-stage con JRE Alpine optimizado

### Infraestructura GCP (55+ recursos Terraform)

- **Cloud Run**: Serverless container platform principal
- **Cloud SQL**: PostgreSQL 14 en IP privada (10.2.0.3)
- **Firestore**: NoSQL database para datos no estructurados
- **Cloud Storage**: Almacenamiento de archivos est√°ticos
- **VPC Network**: Red privada con subredes regionales
- **VPC Connector**: Conectividad privada Cloud Run ‚Üî VPC
- **Artifact Registry**: Repositorio Docker privado
- **Memorystore**: Redis para cach√© distribuido
- **Cloud VPN**: Conexi√≥n segura a on-premises
- **IAM**: Service accounts con permisos m√≠nimos

### CI/CD Dual

- **GitHub Actions**: Pipeline autom√°tico completo
- **Azure DevOps**: Pipeline alternativo con manual gcloud SDK

## üì¶ Requisitos Previos

- **Cuentas Cloud:**

  - Google Cloud Platform con billing habilitado
  - GitHub Account (para Actions)
  - Azure DevOps (opcional)

- **Herramientas Locales:**

  - Java 17 (OpenJDK o Temurin)
  - Maven 3.9+
  - Docker Desktop
  - gcloud CLI
  - Terraform >= 1.6.0
  - Git

- **GCP APIs Habilitadas:**
  ```bash
  gcloud services enable run.googleapis.com
  gcloud services enable sql-component.googleapis.com
  gcloud services enable artifactregistry.googleapis.com
  gcloud services enable compute.googleapis.com
  gcloud services enable vpcaccess.googleapis.com
  gcloud services enable redis.googleapis.com
  ```

## üöÄ Instalaci√≥n Local

### 1. Clonar el repositorio

```bash
git clone https://github.com/dastorga/yappa-challenge.git
cd yappa-challenge
```

### 2. Ejecutar Spring Boot localmente

```bash
cd app

# Compilar con Maven
mvn clean compile

# Ejecutar tests
mvn test

# Ejecutar aplicaci√≥n
mvn spring-boot:run

# O con JAR compilado
mvn package -DskipTests
java -jar target/yappa-challenge-devops-1.0.0.jar
```

La aplicaci√≥n estar√° disponible en `http://localhost:8080`

### 3. Probar con Docker

```bash
cd app

# Build de la imagen (multi-stage)
docker build -t yappa-challenge:local .

# Ejecutar container
docker run -p 8080:8080 \
  -e ENVIRONMENT=dev \
  -e LOG_LEVEL=DEBUG \
  yappa-challenge:local
```

### 4. Endpoints disponibles

**Principales:**

- `GET /` - Mensaje de bienvenida
- `GET /api/info` - Informaci√≥n completa (JVM, threads, uptime)
- `GET|POST /api/echo` - Endpoint de testing

**Actuator (Spring Boot):**

- `GET /actuator/health` - Health check general
- `GET /actuator/health/liveness` - Liveness probe K8s
- `GET /actuator/health/readiness` - Readiness probe K8s
- `GET /actuator/metrics` - M√©tricas disponibles
- `GET /actuator/prometheus` - M√©tricas formato Prometheus
- `GET /actuator/info` - Info de la aplicaci√≥n

## ‚òÅÔ∏è Despliegue en GCP

### 1. Configurar GCP

```bash
# Autenticaci√≥n
gcloud auth login
gcloud auth application-default login

# Configurar proyecto
export GCP_PROJECT_ID="yappa-challenge-devops"
gcloud config set project $GCP_PROJECT_ID

# Habilitar APIs necesarias (ver requisitos previos)
```

### 2. Despliegue Autom√°tico (Recomendado)

```bash
# Usar el script de deploy automatizado
export GCP_PROJECT_ID="yappa-challenge-devops"
./scripts/deploy.sh
```

El script ejecuta autom√°ticamente:

- ‚úÖ Terraform plan & apply (55+ recursos)
- ‚úÖ Docker build & push a Artifact Registry
- ‚úÖ Cloud Run deploy con configuraci√≥n optimizada
- ‚úÖ Smoke tests de endpoints

### 3. Despliegue Manual

#### 3.1 Infraestructura con Terraform

```bash
cd terraform

# Inicializar Terraform
terraform init

# Planificar cambios (revisar 55+ recursos)
terraform plan -var="project_id=$GCP_PROJECT_ID"

# Aplicar infraestructura completa
terraform apply -var="project_id=$GCP_PROJECT_ID"

# Ver outputs importantes
terraform output
```

#### 3.2 Construir y Subir Imagen

```bash
cd app

# Configurar Artifact Registry
gcloud auth configure-docker us-central1-docker.pkg.dev

# Build y push
docker build -t us-central1-docker.pkg.dev/$GCP_PROJECT_ID/yappa-repo/yappa-spring-boot-service:latest .
docker push us-central1-docker.pkg.dev/$GCP_PROJECT_ID/yappa-repo/yappa-spring-boot-service:latest
```

#### 3.3 Deploy a Cloud Run

```bash
gcloud run deploy yappa-spring-boot-service \
  --image=us-central1-docker.pkg.dev/$GCP_PROJECT_ID/yappa-repo/yappa-spring-boot-service:latest \
  --region=us-central1 \
  --platform=managed \
  --allow-unauthenticated \
  --memory=1Gi \
  --cpu=1 \
  --max-instances=10 \
  --min-instances=1 \
  --port=8080 \
  --set-env-vars="SPRING_PROFILES_ACTIVE=dev,ENVIRONMENT=dev,GCP_PROJECT_ID=$GCP_PROJECT_ID,CLOUD_SQL_INSTANCE_IP=10.2.0.3" \
  --vpc-connector=projects/$GCP_PROJECT_ID/locations/us-central1/connectors/yappa-vpc-connector \
  --vpc-egress=private-ranges-only
```

### 4. Verificar Despliegue

```bash
# Obtener URL del servicio
SERVICE_URL=$(gcloud run services describe yappa-spring-boot-service \
  --region=us-central1 \
  --format='value(status.url)')

echo "Servicio desplegado en: $SERVICE_URL"

# Smoke tests
curl -f "$SERVICE_URL/"
curl -f "$SERVICE_URL/actuator/health"
curl -f "$SERVICE_URL/api/info"
```

## üîÑ CI/CD

### GitHub Actions Pipeline (Principal)

El pipeline se ejecuta autom√°ticamente en:

- **Push a `main`** ‚Üí Deploy completo a Cloud Run
- **Push a `develop`** ‚Üí Build y test √∫nicamente
- **Pull Request** ‚Üí Build, test y validaci√≥n
- **Cambios en** `app/`, `terraform/`, `.github/workflows/`

#### Configurar Secrets en GitHub

1. Ve a **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. Agrega el secret requerido:

```bash
# Generar service account key
gcloud iam service-accounts keys create azure-devops-key.json \
  --iam-account=azure-devops-pipeline@yappa-challenge-devops.iam.gserviceaccount.com

# Base64 encode para GitHub
base64 -i azure-devops-key.json

# Agregar como GCP_SERVICE_ACCOUNT_KEY en GitHub Secrets
```

3. Configurar environment 'dev' con el secret

#### Jobs del Pipeline

```yaml
jobs:
  build-and-test: # Maven compile, test, package
  docker-build-push: # Docker build ‚Üí Artifact Registry
  deploy-cloud-run: # Cloud Run deploy + smoke tests
  terraform-plan: # Terraform validate + plan
  terraform-apply: # Terraform apply (solo main)
```

### Azure DevOps Pipeline (Alternativo)

Configurado en `azure-pipelines.yml` con las mismas etapas pero bloqueado por limitaci√≥n de paralelismo de Microsoft.

**Para habilitar Azure DevOps:**

1. Solicitar paralelismo gratuito: [aka.ms/azpipelines-parallelism-request](https://aka.ms/azpipelines-parallelism-request)
2. O configurar self-hosted agent
3. Configurar variables: `GCP_PROJECT_ID`, `GCP_SERVICE_ACCOUNT_KEY`

### Pipeline incluye:

- ‚úÖ **Maven Build**: Compile, test, package con cache
- ‚úÖ **Docker Multi-stage**: Optimizado para Spring Boot
- ‚úÖ **Security Scanning**: Vulnerabilidades en dependencias
- ‚úÖ **Artifact Registry**: Push a repositorio privado GCP
- ‚úÖ **Cloud Run Deploy**: Con VPC connector y env vars
- ‚úÖ **Terraform**: Plan siempre, apply solo en main
- ‚úÖ **Smoke Tests**: Health checks post-deploy
- ‚úÖ **Environment Protection**: Ambiente 'dev' protegido

## üìä Monitoreo

### M√©tricas Nativas de Spring Boot

La aplicaci√≥n expone m√©tricas completas v√≠a **Micrometer** en formato Prometheus:

```bash
# M√©tricas principales
curl https://SERVICE_URL/actuator/prometheus | grep -E "(http_server_requests|jvm_memory|jvm_gc)"

# M√©tricas espec√≠ficas
curl https://SERVICE_URL/actuator/metrics/http.server.requests
curl https://SERVICE_URL/actuator/metrics/jvm.memory.used?tag=area:heap
curl https://SERVICE_URL/actuator/metrics/jvm.threads.live
```

### M√©tricas Clave Disponibles

**HTTP Requests:**

- `http_server_requests_seconds_count{status,method,uri}` - Contador de requests
- `http_server_requests_seconds_bucket` - Latencia en buckets (P50, P95, P99)
- `http_server_requests_seconds_sum` - Tiempo total de requests

**JVM Memory:**

- `jvm_memory_used_bytes{area="heap"}` - Memoria heap utilizada
- `jvm_memory_max_bytes{area="heap"}` - Memoria heap m√°xima
- `jvm_gc_pause_seconds_*` - M√©tricas de Garbage Collection

**Application:**

- `application_started_time_seconds` - Tiempo de startup
- `process_uptime_seconds` - Tiempo de funcionamiento
- `system_cpu_usage` - Uso de CPU del sistema

### Cloud Operations Suite (Stackdriver)

Las m√©tricas de **Cloud Run** se integran autom√°ticamente con **Cloud Monitoring**:

```bash
# Ver m√©tricas en Cloud Console
echo "https://console.cloud.google.com/monitoring/metrics-explorer?project=$GCP_PROJECT_ID"

# M√©tricas de Cloud Run disponibles:
# - run.googleapis.com/container/cpu/utilizations
# - run.googleapis.com/container/memory/utilizations
# - run.googleapis.com/request_count
# - run.googleapis.com/request_latencies
```

### Alertas Recomendadas

Configurable via Cloud Monitoring:

- **Error Rate > 5%**: Requests con status 5xx
- **High Latency > 2s**: P95 de latencia de requests
- **Memory Usage > 85%**: Uso de memoria del container
- **High CPU > 80%**: Utilizaci√≥n de CPU sostenida
- **Health Check Failures**: Fallas en actuator/health

## üìÅ Estructura del Proyecto

```
yappa-challenge/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ci-cd.yml              # GitHub Actions pipeline
‚îÇ   ‚îî‚îÄ‚îÄ copilot-instructions.md    # Gu√≠a para IA agents
‚îú‚îÄ‚îÄ app/                           # üì± Spring Boot Application
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/yappa/challenge/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ YappaChallengeApplication.java  # Main class
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomeController.java         # REST endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ApiController.java          # API endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InfoService.java            # Business logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InfoResponse.java           # DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ActuatorConfig.java         # Actuator config
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml                 # Main config
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-dev.yml             # Dev profile
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ application-prod.yml            # Prod profile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ java/com/yappa/challenge/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ YappaChallengeApplicationTests.java  # Tests
‚îÇ   ‚îú‚îÄ‚îÄ pom.xml                    # Maven dependencies
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                 # Multi-stage Docker build
‚îÇ   ‚îî‚îÄ‚îÄ .dockerignore              # Docker ignore rules
‚îú‚îÄ‚îÄ terraform/                     # üèóÔ∏è Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ main.tf                    # Main Terraform config
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf               # Input variables
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf                 # Output values
‚îÇ   ‚îú‚îÄ‚îÄ providers.tf               # GCP provider config
‚îÇ   ‚îú‚îÄ‚îÄ cloud-run.tf              # Cloud Run service
‚îÇ   ‚îú‚îÄ‚îÄ cloud-sql.tf              # PostgreSQL database
‚îÇ   ‚îú‚îÄ‚îÄ networking.tf             # VPC, subnets, firewall
‚îÇ   ‚îú‚îÄ‚îÄ storage.tf                # Cloud Storage buckets
‚îÇ   ‚îú‚îÄ‚îÄ firestore.tf              # NoSQL database
‚îÇ   ‚îú‚îÄ‚îÄ memorystore.tf            # Redis cache
‚îÇ   ‚îú‚îÄ‚îÄ artifact-registry.tf      # Docker registry
‚îÇ   ‚îú‚îÄ‚îÄ vpc-connector.tf          # Private connectivity
‚îÇ   ‚îú‚îÄ‚îÄ vpn.tf                    # VPN to on-premises
‚îÇ   ‚îú‚îÄ‚îÄ iam.tf                    # Service accounts & IAM
‚îÇ   ‚îî‚îÄ‚îÄ terraform.tf              # Terraform version constraints
‚îú‚îÄ‚îÄ scripts/                       # üöÄ Deployment Scripts
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh                  # Automated deployment
‚îÇ   ‚îî‚îÄ‚îÄ rollback.sh                # Rollback script
‚îú‚îÄ‚îÄ docs/                          # üìö Documentation
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md            # System architecture
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md              # Deployment guide
‚îÇ   ‚îî‚îÄ‚îÄ TROUBLESHOOTING.md         # Common issues
‚îú‚îÄ‚îÄ azure-pipelines.yml            # Azure DevOps pipeline
‚îú‚îÄ‚îÄ .gitignore                     # Git ignore rules
‚îî‚îÄ‚îÄ README.md                      # This file
```

## üîß Comandos √ötiles

### Maven & Spring Boot

```bash
cd app

# Compilar
mvn clean compile

# Tests con coverage
mvn test
mvn jacoco:report  # Coverage report en target/site/jacoco/

# Ejecutar aplicaci√≥n
mvn spring-boot:run
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# Package JAR
mvn clean package -DskipTests
java -jar target/yappa-challenge-devops-1.0.0.jar

# Debug mode
mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"
```

### Docker

```bash
cd app

# Build multi-stage
docker build -t yappa-challenge:latest .

# Run con variables de entorno
docker run -p 8080:8080 \
  -e ENVIRONMENT=dev \
  -e LOG_LEVEL=DEBUG \
  -e JAVA_OPTS="-Xms256m -Xmx512m" \
  yappa-challenge:latest

# Push a Artifact Registry
export REGISTRY_URL="us-central1-docker.pkg.dev/yappa-challenge-devops/yappa-repo"
docker tag yappa-challenge:latest $REGISTRY_URL/yappa-spring-boot-service:latest
docker push $REGISTRY_URL/yappa-spring-boot-service:latest
```

### Cloud Run

```bash
# Ver logs en tiempo real
gcloud run services logs tail yappa-spring-boot-service --region=us-central1

# Actualizar configuraci√≥n
gcloud run services update yappa-spring-boot-service \
  --region=us-central1 \
  --memory=2Gi \
  --cpu=2

# Ver m√©tricas
gcloud run services describe yappa-spring-boot-service \
  --region=us-central1 \
  --format="get(status.url,status.conditions)"

# Rollback a versi√≥n anterior
gcloud run services update-traffic yappa-spring-boot-service \
  --region=us-central1 \
  --to-revisions=REVISION-NAME=100
```

### Terraform

```bash
cd terraform

# Ver estado actual
terraform show
terraform state list

# Ver outputs espec√≠ficos
terraform output cloud_run_url
terraform output cloud_sql_ip
terraform output artifact_registry_url

# Importar recursos existentes
terraform import google_cloud_run_service.yappa projects/PROJECT/locations/REGION/services/SERVICE

# Destruir infraestructura
terraform destroy -var="project_id=$GCP_PROJECT_ID"
```

### Debugging y Monitoreo

```bash
# Health checks
curl -f https://SERVICE_URL/actuator/health
curl -f https://SERVICE_URL/actuator/health/liveness
curl -f https://SERVICE_URL/actuator/health/readiness

# M√©tricas Prometheus
curl https://SERVICE_URL/actuator/prometheus

# Info de JVM
curl https://SERVICE_URL/actuator/metrics/jvm.memory.used
curl https://SERVICE_URL/actuator/metrics/jvm.threads.live
curl https://SERVICE_URL/actuator/metrics/http.server.requests

# Thread dump (√∫til para debugging)
curl https://SERVICE_URL/actuator/threaddump
```

## üõ°Ô∏è Seguridad

### Container Security

- **Base Image**: Eclipse Temurin 17 JRE Alpine (minimal)
- **Non-root User**: Container ejecuta como UID 1000
- **Multi-stage Build**: Artifacts de build no incluidos en imagen final
- **Security Scanning**: Dependencias Maven escaneadas en CI/CD

### Network Security

- **VPC Private**: Cloud Run conecta via VPC Connector
- **Private IPs**: Cloud SQL en IP privada (10.2.0.3)
- **Firewall Rules**: Tr√°fico restringido por reglas espec√≠ficas
- **VPN Gateway**: Conexi√≥n segura a on-premises

### Access Control

- **IAM Roles**: Service accounts con permisos m√≠nimos requeridos
- **Secret Manager**: Credenciales almacenadas de forma segura
- **OAuth 2.0**: Autenticaci√≥n para APIs de GCP
- **Environment Protection**: GitHub Actions con environment 'dev' protegido

### Service Accounts

```bash
# Service account principal para CI/CD
azure-devops-pipeline@yappa-challenge-devops.iam.gserviceaccount.com

# Roles asignados:
# - Artifact Registry Writer
# - Cloud Run Admin
# - Cloud SQL Admin
# - Compute Admin
# - Editor (para Terraform)
```

## üöÄ Pr√≥ximos Pasos

- [ ] Configurar **Cloud Armor** para protecci√≥n DDoS
- [ ] Implementar **Identity-Aware Proxy** para autenticaci√≥n
- [ ] Agregar **Cloud CDN** para contenido est√°tico
- [ ] Configurar **Multi-region** para alta disponibilidad
- [ ] Implementar **Blue-Green Deployment** en Cloud Run
- [ ] Agregar **Chaos Engineering** con Gremlin

## üìä M√©tricas del Proyecto

- **üì¶ Recursos Terraform**: 55+ recursos desplegados
- **üèóÔ∏è L√≠neas de C√≥digo**: ~2,000 l√≠neas (Spring Boot + IaC)
- **‚ö° Tiempo de Deploy**: ~8-12 minutos (completo)
- **üîÑ Pipeline Duration**: ~5-7 minutos (GitHub Actions)
- **üí∞ Costo Estimado**: $15-30 USD/mes (con tr√°fico m√≠nimo)

## üìù Licencia

MIT License - ver archivo [LICENSE](LICENSE)

## üë• Autor

**Dario Maximiliano Astorga**  
DevOps Engineer - Yappa Challenge  
üìß [dario.astorga@ejemplo.com](mailto:dario.astorga@ejemplo.com)  
üêô [GitHub](https://github.com/dastorga)  
üíº [LinkedIn](https://linkedin.com/in/dario-astorga)

## ü§ù Contribuciones

Las contribuciones son bienvenidas! Por favor sigue estos pasos:

1. **Fork** el proyecto
2. **Crear** feature branch: `git checkout -b feature/nueva-funcionalidad`
3. **Commit** cambios: `git commit -am 'feat: agregar nueva funcionalidad'`
4. **Push** a branch: `git push origin feature/nueva-funcionalidad`
5. **Abrir** Pull Request

### Convenciones

- **Commits**: Seguir [Conventional Commits](https://conventionalcommits.org/es/)
- **Branches**: `feature/`, `bugfix/`, `hotfix/`
- **Tests**: Agregar tests para nueva funcionalidad
- **Docs**: Actualizar documentaci√≥n relevante

---

## üéØ Challenge Completado

‚úÖ **Infraestructura GCP** - 55+ recursos con Terraform  
‚úÖ **Aplicaci√≥n Spring Boot** - Java 17 con Actuator y Micrometer  
‚úÖ **CI/CD Dual** - GitHub Actions + Azure DevOps  
‚úÖ **Monitoreo Nativo** - M√©tricas Prometheus + Cloud Monitoring  
‚úÖ **Seguridad** - VPC privada + IAM + Container security  
‚úÖ **Documentaci√≥n** - README completo + gu√≠as t√©cnicas

**Tiempo Total**: ~40 horas  
**Tecnolog√≠as**: Spring Boot, GCP, Terraform, Docker, GitHub Actions  
**Resultado**: Infraestructura cloud-native production-ready üöÄ
